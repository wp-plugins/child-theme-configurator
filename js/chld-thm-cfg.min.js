/*!
 *  Script: chld-thm-cfg.js
 *  Plugin URI: http://www.lilaeamedia.com/plugins/child-theme-configurator/
 *  Description: Handles jQuery, AJAX and other UI
 *  Version: 1.1.0
 *  Author: Lilaea Media
 *  Author URI: http://www.lilaeamedia.com/
 *  License: GPLv2
 *  Copyright (C) 2013 Lilaea Media
 */
;jQuery(document).ready(function(f){var k="\n",l=function(m){f(m).iris({change:function(){i(m)}})},i=function(s){var o=/^(ctc_(ovrd_)?(parent|child)_([a-z\-]+)_(\d+))(_\w+)?$/,t=f(s).parents(".ctc-selector-row, .ctc-parent-row").first(),r=t.find(".ctc-swatch").first(),q={parent:{},child:{}},p={parent:{origin:"",start:"",end:""},child:{origin:"",start:"",end:""}},n={child:false,parent:false},m={};t.find(".ctc-parent-value, .ctc-child-value").each(function(){var A=f(this).attr("id"),u=A.match(o),v=u[3],C=("undefined"==typeof u[4]?"":u[4]),z=u[5],y=("undefined"==typeof u[6]?"":u[6]),B=("parent"==v?f(this).text():f(this).val()),x,w;if("child"==v){m[A]=B}if(a(B)){return}if(false===a(y)){switch(y){case"_border_width":q[v][C+"-width"]=B;break;case"_border_style":q[v][C+"-style"]=B;break;case"_border_color":q[v][C+"-color"]=B;break;case"_background_url":q[v]["background-image"]=c(v,B);break;case"_background_color":q[v]["background-color"]=s.value;break;case"_background_color1":p[v].start=B;n[v]=true;break;case"_background_color2":p[v].end=B;n[v]=true;break;case"_background_origin":p[v].origin=B;n[v]=true;break}}else{if(x=C.match(/^border(\-(top|right|bottom|left))?$/)&&!B.match(/none/)){w=B.split(/ +/);q[v][C+"-width"]="undefined"==typeof w[0]?"":w[0];q[v][C+"-style"]="undefined"==typeof w[1]?"":w[1];q[v][C+"-color"]="undefined"==typeof w[2]?"":w[2]}else{if("background-image"==C){if(B.match(/url\(/)){q[v]["background-image"]=c(v,B)}else{w=B.split(/ +/);if(w.length>2){p[v].origin="undefined"==typeof w[0]?"top":w[0];p[v].start="undefined"==typeof w[1]?"transparent":w[1];p[v].end="undefined"==typeof w[2]?"transparent":w[2];n[v]=true}else{q[v]["background-image"]=B}}}else{q[v][C]=B}}}});if("undefined"!=typeof r){f(r).removeAttr("style");if(n.parent){f(r).ctcgrad(p.parent.origin,[p.parent.start,p.parent.end])}f(r).css(q.parent);if(!(r.attr("id").match(/parent/))){if(n.child){f(r).ctcgrad(p.child.origin,[p.child.start,p.child.end])}f(r).css(q.child)}}return m},b=function(o){var n,p,m;f(o).each(function(){switch(this.obj){case"imports":ctcAjax.imports=this.data;break;case"rule_val":ctcAjax.rule_val[this.key]=this.data;currRuleId=this.key;break;case"val_qry":ctcAjax.val_qry[this.key]=this.data;break;case"rule":ctcAjax.rule=this.data;break;case"sel_ndx":if(a(this.key)){ctcAjax.sel_ndx=this.data}else{if("qsid"==this.key){ctcAjax.sel_ndx[this.data.query][this.data.selector]=this.data.qsid}else{ctcAjax.sel_ndx[this.key]=this.data;n=this.key}}break;case"sel_val":ctcAjax.sel_val[this.key]=this.data;p=this.key;break}})},c=function(q,n){var p=n.match(/url\([" ]*(.+?)[" ]*\)/),o=("undefined"==typeof p?null:p[1]),m=ctcAjax.theme_uri+"/"+("parent"==q?ctcAjax.parnt:ctcAjax.child)+"/",r;if(!o){return false}else{if(o.match(/^(http:|\/)/)){r=n}else{r="url("+m+o+")"}}return r},a=function(n){if("undefined"==typeof n||false===n||null===n||""===n||0===n){return true}if(true===n||"string"===typeof n||"number"===typeof n){return false}if("object"===typeof n){for(var m in n){if(n.hasOwnProperty(m)){return false}}return true}return false},h=function(){var m=[];if(1===loading.sel_ndx){return m}if(0===loading.sel_ndx){loading.sel_ndx=1;ctc_query_css("sel_ndx",null,ctc_setup_query_menu);return m}if(false===a(ctcAjax.sel_ndx)){f.each(ctcAjax.sel_ndx,function(n,o){var p={label:n,value:n};m.push(p)})}return m},e=function(n){var m=[];if(1===loading.sel_ndx){return m}if(0===loading.sel_ndx){loading.sel_ndx=1;ctc_query_css("sel_ndx",n,ctc_setup_selector_menu);return m}if(false===a(ctcAjax.sel_ndx[n])){f.each(ctcAjax.sel_ndx[n],function(o,p){var q={label:o,value:p};m.push(q)})}return m},j=function(){var m=[];if(1===loading.rule){return m}if(0===loading.rule){loading.rule=1;ctc_query_css("rule",null,ctc_setup_rule_menu);return m}if(false===a(ctcAjax.rule)){f.each(ctcAjax.rule,function(n,o){var p={label:o,value:n};m.push(p)})}return m.sort(function(o,n){if(o.label>n.label){return 1}if(o.label<n.label){return -1}return 0})},g=function(o,s,n){var p="",r=(a(ctcAjax.sel_val[o])||a(ctcAjax.sel_val[o].value)||a(ctcAjax.sel_val[o].value[s])?"":ctcAjax.sel_val[o].value[s]),q=ctc_decode_value(s,("undefined"==typeof r?"":r.parnt)),m=ctc_decode_value(s,("undefined"==typeof r?"":r.child));if(false===a(ctcAjax.sel_val[o])){p+='<div class="ctc-'+(n?"selector":"input")+'-row clearfix">'+k;p+='<div class="ctc-input-cell">'+(n?ctcAjax.sel_val[o].selector+(a(q.orig)?"<br/>"+ctcAjax.child_only_txt:""):s)+"</div>"+k;if(!n){p+='<div class="ctc-parent-value ctc-input-cell" id="ctc_parent_'+s+"_"+o+'">'+(a(q.orig)?"[no value]":q.orig)+"</div>"+k}p+='<div class="ctc-input-cell">'+k;if(false===a(q.names)){f.each(q.names,function(t,u){u=(a(u)?"":u);p+='<div class="ctc-child-input-cell">'+k;var w="ctc_"+(n?"":"ovrd_")+"child_"+s+"_"+o+u,v;if(!(v=m.values.shift())){v=""}p+=(a(u)?"":ctcAjax.field_labels[u]+":<br/>")+'<input type="text" id="'+w+'" name="'+w+'" class="ctc-child-value'+((u+s).match(/color/)?" color-picker":"")+((u).match(/url/)?" ctc-input-wide":"")+'" value="'+v+'" />'+k;p+="</div>"+k})}p+="</div>"+k;p+=(n?'<div class="ctc-swatch ctc-specific" id="ctc_child_'+s+"_"+o+'_swatch">'+ctcAjax.swatch_txt+"</div>"+k+'<div class="ctc-child-input-cell ctc-button-cell" id="ctc_save_'+s+"_"+o+'_cell">'+k+'<input type="button" class="button ctc-save-input" id="ctc_save_'+s+"_"+o+'" name="ctc_save_'+s+"_"+o+'" value="Save" /></div>'+k:"");p+="</div><!-- end input row -->"+k}return p},d=function(m){if(1===loading.sel_val){return false}if(0==loading.sel_val){loading.sel_val=1;ctc_query_css("sel_val",m,d);return false}var n="";if(false===a(ctcAjax.sel_val[m]&&false===a(ctcAjax.sel_val[m].value))){f.each(ctcAjax.sel_val[m].value,function(p,o){n+=g(m,p,false)})}f("#ctc_sel_ovrd_rule_inputs").html(n).find(".color-picker").each(function(){l(this)});i("#ctc_child_all_0_swatch")};ctc_render_rule_value_inputs=function(n){if(1===loading.rule_val){return false}if(0==loading.rule_val){loading.rule_val=1;ctc_query_css("rule_val",n,ctc_render_rule_value_inputs);return false}var o=ctcAjax.rule[n],m='<div class="ctc-input-row clearfix" id="ctc_rule_row_'+o+'">'+k;if(false===a(ctcAjax.rule_val[n])){f.each(ctcAjax.rule_val[n],function(q,r){var p=ctc_decode_value(o,r);m+='<div class="ctc-parent-row clearfix" id="ctc_rule_row_'+o+"_"+q+'">'+k;m+='<div class="ctc-input-cell ctc-parent-value" id="ctc_parent_'+o+"_"+q+'">'+p.orig+"</div>"+k;m+='<div class="ctc-input-cell">'+k;m+='<div class="ctc-swatch ctc-specific" id="ctc_parent_'+o+"_"+q+'_swatch">'+ctcAjax.swatch_txt+"</div></div>"+k;m+='<div class="ctc-input-cell"><a href="#" class="ctc-selector-handle" id="ctc_selector_'+o+"_"+q+'">'+ctcAjax.selector_txt+"</a></div>"+k;m+='<div id="ctc_selector_'+o+"_"+q+'_container" class="ctc-selector-container clearfix">'+k;m+='<a href="#" id="ctc_selector_'+o+"_"+q+'_close" class="ctc-selector-handle" style="float:right">'+ctcAjax.close_txt+'</a><div id="ctc_status_val_qry_'+q+'"></div>'+k;m+='<div id="ctc_selector_'+o+"_"+q+'_rows"></div>'+k;m+="</div></div>"+k});m+="</div>"+k}f("#ctc_rule_value_inputs").html(m).find(".ctc-swatch").each(function(){i(this)})},ctc_render_selector_value_inputs=function(p){if(1==loading.val_qry){return false}var r,n,q=f("#ctc_rule_menu_selected").text(),m,o="";if(0===loading.val_qry){loading.val_qry=1;r={rule:q};ctc_query_css("val_qry",p,ctc_render_selector_value_inputs,r);return false}if(false===a(ctcAjax.val_qry[p])){f.each(ctcAjax.val_qry[p],function(t,s){page_rule=t;f.each(s,function(v,u){o+='<h4 class="ctc-query-heading">'+v+"</h4>"+k;if(false===a(u)){f.each(u,function(w,x){ctcAjax.sel_val[w]=x;o+=g(w,t,true)})}})})}m="#ctc_selector_"+q+"_"+p+"_rows";f(m).html(o).find(".color-picker").each(function(){l(this)});f(m).find(".ctc-swatch").each(function(){i(this)})},ctc_query_css=function(o,n,r,p){var m={ctc_query_obj:o,ctc_query_key:n},q="#ctc_status_"+o+("val_qry"==o?"_"+n:"");if("object"===typeof p){f.each(p,function(s,t){m["ctc_query_"+s]=t})}f(".ctc-status-icon").remove();f(q).append('<span class="ctc-status-icon spinner"></span>');f(".spinner").show();m.action="ctc_query";m._wpnonce=f("#_wpnonce").val();f.post(ctcAjax.ajaxurl,m,function(s){loading[o]=2;f(".ctc-status-icon").removeClass("spinner");if(a(s)){f(".ctc-status-icon").addClass("failure")}else{f(".ctc-status-icon").addClass("success");b(s);if("function"===typeof r){r(n)}return false}},"json").fail(function(){loading[o]=0;f(".ctc-status-icon").removeClass("spinner");f(".ctc-status-icon").addClass("failure")});return false},ctc_save=function(q){var p={},r,o,m,n;f(q).prop("disabled",true);f(".ctc-status-icon").remove();f(q).parent(".ctc-textarea-button-cell, .ctc-button-cell").append('<span class="ctc-status-icon spinner"></span>');f(".spinner").show();if((r=f("#ctc_new_selectors"))&&"ctc_save_new_selectors"==f(q).attr("id")){p.ctc_new_selectors=r.val();if(o=f("#ctc_sel_ovrd_query_selected")){p.ctc_sel_ovrd_query=o.text()}}else{if((m=f("#ctc_child_imports"))&&"ctc_save_imports"==f(q).attr("id")){p.ctc_child_imports=m.val()}else{p=i(q)}}p.action="ctc_update";p._wpnonce=f("#_wpnonce").val();f.post(ctcAjax.ajaxurl,p,function(s){f(q).prop("disabled",false);f(".ctc-status-icon").removeClass("spinner");if(a(s)){f(".ctc-status-icon").addClass("failure")}else{f(".ctc-status-icon").addClass("success");f("#ctc_new_selectors").val("");b(s);ctc_setup_menus()}return false},"json").fail(function(){f(q).prop("disabled",false);f(".ctc-status-icon").removeClass("spinner");f(".ctc-status-icon").addClass("failure")});return false},ctc_decode_value=function(o,m){m=("undefined"==typeof m?"":m);var n={orig:m};if(o.match(/^border(\-(top|right|bottom|left))?$/)){var p=m.split(/ +/);n.names=["_border_width","_border_style","_border_color"];n.values=[("undefined"==typeof p[0]?"":p[0]),("undefined"==typeof p[1]?"":p[1]),("undefined"==typeof p[2]?"":p[2])]}else{if(o.match(/^background\-image/)){n.names=["_background_url","_background_origin","_background_color1","_background_color2"];n.values=["","","",""];if(m.match(/:/)){var p=m.split(/:/);n.values[1]=("undefined"==typeof p[0]?"":p[0]);n.values[2]=("undefined"==typeof p[1]?"":p[1]);n.values[3]=("undefined"==typeof p[3]?"":p[3]);n.orig=[n.values[1],n.values[2],n.values[3]].join(" ")}else{n.values[0]=m}}else{n.names=[""];n.values=[m]}}return n},ctc_set_query=function(m){f("#ctc_sel_ovrd_query").val("");f("#ctc_sel_ovrd_query_selected").text(m);ctc_setup_selector_menu(m);f("#ctc_new_selector_row").show()},ctc_set_selector=function(n,m){f("#ctc_sel_ovrd_selector").val("");f("#ctc_sel_ovrd_selector_selected").text(m);f("#ctc_sel_ovrd_qsid").val(n);if(1!=loading.sel_val){loading.sel_val=0}d(n);f("#ctc_sel_ovrd_new_rule, #ctc_sel_ovrd_rule_header,#ctc_sel_ovrd_rule_inputs_container,#ctc_sel_ovrd_rule_inputs").show()},ctc_set_rule=function(n,m){f("#ctc_rule_menu").val("");f("#ctc_rule_menu_selected").text(m);if(1!=loading.rule_val){loading.rule_val=0}ctc_render_rule_value_inputs(n);f("#ctc_rule_value_inputs,#ctc_input_row_rule_header").show()},ctc_setup_query_menu=function(){ctc_queries=h();f("#ctc_sel_ovrd_query").autocomplete({source:ctc_queries,minLength:0,selectFirst:true,autoFocus:true,select:function(n,m){ctc_set_query(m.item.value);return false},focus:function(m){m.preventDefault()}})},ctc_setup_selector_menu=function(m){ctc_selectors=e(m);f("#ctc_sel_ovrd_selector").autocomplete({source:ctc_selectors,selectFirst:true,autoFocus:true,select:function(o,n){ctc_set_selector(n.item.value,n.item.label);return false},focus:function(n){n.preventDefault()}})},ctc_setup_rule_menu=function(){ctc_rules=j();f("#ctc_rule_menu").autocomplete({source:ctc_rules,selectFirst:true,autoFocus:true,select:function(n,m){ctc_set_rule(m.item.value,m.item.label);return false},focus:function(m){m.preventDefault()}})},ctc_setup_new_rule_menu=function(){f("#ctc_new_rule_menu").autocomplete({source:ctc_rules,selectFirst:true,autoFocus:true,select:function(o,n){var m=f("#ctc_sel_ovrd_qsid").val();f("#ctc_sel_ovrd_rule_inputs").append(g(m,n.item.label,false)).find(".color-picker").each(function(){l(this)});f("#ctc_new_rule_menu").val("");return false},focus:function(m){m.preventDefault()}})},ctc_setup_menus=function(){ctc_setup_query_menu();ctc_setup_selector_menu("");ctc_setup_rule_menu();ctc_setup_new_rule_menu()},ctc_theme_exists=function(m,n){var o=false;f.each(ctcAjax.themes,function(p,q){f.each(q,function(r,s){if(r==m&&("parnt"==p||"new"==n)){o=true;return false}});if(o){return false}});return o},ctc_set_notice=function(m){var n="";if(false===a(m)){f.each(m,function(o,p){n+='<div class="'+o+'"><ul>'+k;f(p).each(function(q,r){n+="<li>"+r.toString()+"</li>"+k});n+="</ul></div>"})}f("#ctc_error_notice").html(n)},ctc_validate=function(){var p=/[^\w\-]/,n=f("#ctc_child_template").val().replace(p).toLowerCase(),m=f("#ctc_theme_child").val().replace(p).toLowerCase(),o=f("input[name=ctc_child_type]:checked").val(),q=[];if("new"==o){m=n}if(ctc_theme_exists(m,o)){q.push(ctcAjax.theme_exists_txt.replace(/%s/,m))}if(""==m||m.match(/^[^a-z]/)){q.push(ctcAjax.inval_theme_txt)}if(""==f("#ctc_child_name").val()){q.push(ctcAjax.inval_name_txt)}if(q.length){ctc_set_notice({error:q});return false}return true},ctc_set_theme_menu=function(){var m=f("#ctc_theme_child").val();if(false===a(ctcAjax.themes.child[m])){f("#ctc_child_name").val(ctcAjax.themes.child[m].Name);f("#ctc_child_author").val(ctcAjax.themes.child[m].Author);f("#ctc_child_version").val(ctcAjax.themes.child[m].Version)}},fade_update_notice=function(){f(".updated").fadeOut("slow",function(){f(".updated").remove()})},loading={rule:2,sel_ndx:2,val_qry:0,rule_val:0,sel_val:0},ctc_selectors=[],ctc_queries=[],ctc_rules=[];f(".color-picker").each(function(){l(this)});f(".ctc-option-panel-container").on("focus",".color-picker",function(){ctc_set_notice("");f(this).iris("toggle");f(".iris-picker").css({position:"absolute","z-index":10})});f(".ctc-option-panel-container").on("focus","input",function(){ctc_set_notice("");f(".color-picker").not(this).iris("hide")});f(".ctc-option-panel-container").on("change",".ctc-child-value",function(){i(this)});f(".ctc-option-panel-container").on("click",".ctc-selector-handle",function(n){n.preventDefault();ctc_set_notice("");var o=f(this).attr("id").replace("_close",""),m=o.replace(/\D+/g,"");if(f("#"+o+"_container").is(":hidden")){if(1!=loading.val_qry){loading.val_qry=0}ctc_render_selector_value_inputs(m)}f("#"+o+"_container").fadeToggle("fast");f(".ctc-selector-container").not("#"+o+"_container").fadeOut("fast")});f(".nav-tab").on("click",function(n){n.preventDefault();ctc_set_notice("");var o="#"+f(this).attr("id"),m=o+"_panel";f(".nav-tab").removeClass("nav-tab-active");f(".ctc-option-panel").removeClass("ctc-option-panel-active");f(".ctc-selector-container").hide();f(o).addClass("nav-tab-active");f(".ctc-option-panel-container").scrollTop(0);f(m).addClass("ctc-option-panel-active")});f("#view_child_options,#view_parnt_options").on("click",function(p){ctc_set_notice("");var m=new Date().getTime(),o=f(this).attr("id").match(/(child|parnt)/)[1],n=ctcAjax.theme_uri+"/"+ctcAjax[o]+"/style.css?"+m;f.get(n,function(q){f("#view_"+o+"_options_panel").text(q)}).fail(function(){f("#view_"+o+"_options_panel").text(ctcAjax.css_fail_txt)})});f("#ctc_load_form").on("submit",function(){return(ctc_validate()&&confirm(ctcAjax.load_txt))});f(document).on("click",".ctc-save-input",function(m){ctc_save(this)});ctc_setup_menus();f("input[type=submit],input[type=button]").prop("disabled",false);setTimeout(fade_update_notice,6000)});
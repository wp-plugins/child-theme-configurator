/*!
 *  Script: chld-thm-cfg.js
 *  Plugin URI: http://www.lilaeamedia.com/plugins/child-theme-configurator/
 *  Description: Handles jQuery, AJAX and other UI
 *  Version: 1.2.1
 *  Author: Lilaea Media
 *  Author URI: http://www.lilaeamedia.com/
 *  License: GPLv2
 *  Copyright (C) 2013 Lilaea Media
 */
;jQuery(document).ready(function(g){var p="\n",m="base",a,o={},q=function(r){g(r).iris({change:function(){k(r)}})},l=function(t){var r=parseInt(t),s=String.fromCharCode(r);return s},i=function(s){var r=s.charCodeAt(0);return r},k=function(x){var t=/^(ctc_(ovrd|\d+)_(parent|child)_([0-9a-z\-]+)_(\d+))(_\w+)?$/,y=g(x).parents(".ctc-selector-row, .ctc-parent-row").first(),w=y.find(".ctc-swatch").first(),v={parent:{},child:{}},u={parent:{origin:"",start:"",end:""},child:{origin:"",start:"",end:""}},s={child:false,parent:false},r={};y.find(".ctc-parent-value, .ctc-child-value").each(function(){var G=g(this).attr("id"),z=G.toString().match(t),H=z[2],A=z[3],J=("undefined"==typeof z[4]?"":z[4]),F=z[5],E=("undefined"==typeof z[6]?"":z[6]),I=("parent"==A?g(this).text():g(this).val()),B="ctc_"+H+"_child_"+J+"_i_"+F,D,C;if("child"==A){r[G]=I;r[B]=(g("#"+B).is(":checked"))?1:0}if(false===b(E)){switch(E){case"_border_width":v[A][J+"-width"]=I;break;case"_border_style":v[A][J+"-style"]=I;break;case"_border_color":v[A][J+"-color"]=I;break;case"_background_url":v[A]["background-image"]=d(A,I);break;case"_background_color":v[A]["background-color"]=x.value;break;case"_background_color1":u[A].start=I;s[A]=true;break;case"_background_color2":u[A].end=I;s[A]=true;break;case"_background_origin":u[A].origin=I;s[A]=true;break}}else{if(D=J.toString().match(/^border(\-(top|right|bottom|left))?$/)&&!I.match(/none/)){C=I.toString().split(/ +/);v[A][J+"-width"]="undefined"==typeof C[0]?"":C[0];v[A][J+"-style"]="undefined"==typeof C[1]?"":C[1];v[A][J+"-color"]="undefined"==typeof C[2]?"":C[2]}else{if("background-image"==J){if(I.toString().match(/url\(/)){v[A]["background-image"]=d(A,I)}else{C=I.toString().split(/ +/);if(C.length>2){u[A].origin="undefined"==typeof C[0]?"top":C[0];u[A].start="undefined"==typeof C[1]?"transparent":C[1];u[A].end="undefined"==typeof C[2]?"transparent":C[2];s[A]=true}else{v[A]["background-image"]=I}}}else{v[A][J]=I}}}});if("undefined"!=typeof w){g(w).removeAttr("style");if(s.parent){g(w).ctcgrad(u.parent.origin,[u.parent.start,u.parent.end])}g(w).css(v.parent);if(!(w.attr("id").toString().match(/parent/))){if(s.child){g(w).ctcgrad(u.child.origin,[u.child.start,u.child.end])}g(w).css(v.child)}}return r},c=function(t){var s,u,r;g(t).each(function(){switch(this.obj){case"imports":ctcAjax.imports=this.data;break;case"rule_val":ctcAjax.rule_val[this.key]=this.data;currRuleId=this.key;break;case"val_qry":ctcAjax.val_qry[this.key]=this.data;break;case"rule":ctcAjax.rule=this.data;break;case"sel_ndx":if(b(this.key)){ctcAjax.sel_ndx=this.data}else{if("qsid"==this.key){if(b(ctcAjax.sel_ndx[this.data.query])){ctcAjax.sel_ndx[this.data.query]={}}ctcAjax.sel_ndx[this.data.query][this.data.selector]=this.data.qsid}else{ctcAjax.sel_ndx[this.key]=this.data;s=this.key}}break;case"sel_val":ctcAjax.sel_val[this.key]=this.data;u=this.key;break}})},d=function(v,s){var u=s.toString().match(/url\([" ]*(.+?)[" ]*\)/),t=("undefined"==typeof u?null:u[1]),r=ctcAjax.theme_uri+"/"+("parent"==v?ctcAjax.parnt:ctcAjax.child)+"/",w;if(!t){return false}else{if(t.toString().match(/^(https?:|\/)/)){w=s}else{w="url("+r+t+")"}}return w},b=function(s){if("undefined"==typeof s||false===s||null===s||""===s){return true}if(true===s||"string"===typeof s||"number"===typeof s){return false}if("object"===typeof s){for(var r in s){if(s.hasOwnProperty(r)){return false}}return true}return false},j=function(){var r=[];if(1===loading.sel_ndx){return r}if(0===loading.sel_ndx){loading.sel_ndx=1;ctc_query_css("sel_ndx",null,ctc_setup_query_menu);return r}if(false===b(ctcAjax.sel_ndx)){g.each(ctcAjax.sel_ndx,function(s,t){var u={label:s,value:s};r.push(u)})}return r},f=function(s){var r=[];if(1===loading.sel_ndx){return r}if(0===loading.sel_ndx){loading.sel_ndx=1;ctc_query_css("sel_ndx",s,ctc_setup_selector_menu);return r}if(false===b(ctcAjax.sel_ndx[s])){g.each(ctcAjax.sel_ndx[s],function(t,u){var v={label:t,value:u};r.push(v)})}return r},n=function(){var r=[];if(1===loading.rule){return r}if(0===loading.rule){loading.rule=1;ctc_query_css("rule",null,ctc_setup_rule_menu);return r}if(false===b(ctcAjax.rule)){g.each(ctcAjax.rule,function(s,t){var u={label:t.replace(/\d+/g,l),value:s};r.push(u)})}return r.sort(function(t,s){if(t.label>s.label){return 1}if(t.label<s.label){return -1}return 0})},h=function(v,x,A){var t="",y=(b(ctcAjax.sel_val[v])||b(ctcAjax.sel_val[v].value)||b(ctcAjax.sel_val[v].value[x])?"":ctcAjax.sel_val[v].value[x]),s=ctc_decode_value(x,("undefined"==typeof y?"":y.parnt)),w=(false===b(y.i_parnt)&&y.i_parnt)?ctcAjax.important_label:"",u=ctc_decode_value(x,("undefined"==typeof y?"":y.child)),r=(false===b(y.i_child)&&y.i_child)?1:0,z="ctc_"+A+"_child_"+x+"_i_"+v;if(false===b(ctcAjax.sel_val[v])){t+='<div class="ctc-'+("ovrd"==A?"input":"selector")+'-row clearfix">'+p;t+='<div class="ctc-input-cell">'+("ovrd"==A?x.replace(/\d+/g,l):ctcAjax.sel_val[v].selector+'<br/><a href="#" class="ctc-selector-edit" id="ctc_selector_edit_'+v+'" >'+ctcAjax.edit_txt+"</a> "+(b(s.orig)?ctcAjax.child_only_txt:""))+"</div>"+p;if("ovrd"==A){t+='<div class="ctc-parent-value ctc-input-cell" id="ctc_'+A+"_parent_"+x+"_"+v+'">'+(b(s.orig)?"[no value]":s.orig+w)+"</div>"+p}t+='<div class="ctc-input-cell">'+p;if(false===b(s.names)){g.each(s.names,function(B,C){C=(b(C)?"":C);t+='<div class="ctc-child-input-cell">'+p;var E="ctc_"+A+"_child_"+x+"_"+v+C,D;if(false===(D=u.values.shift())){D=""}t+=(b(C)?"":ctcAjax.field_labels[C]+":<br/>")+'<input type="text" id="'+E+'" name="'+E+'" class="ctc-child-value'+((C+x).toString().match(/color/)?" color-picker":"")+((C).toString().match(/url/)?" ctc-input-wide":"")+'" value="'+D+'" />'+p;t+="</div>"+p});t+='<label for="'+z+'"><input type="checkbox" id="'+z+'" name="'+z+'" value="1" '+(1===r?"checked":"")+" />"+ctcAjax.important_label+"</label>"+p}t+="</div>"+p;t+=("ovrd"==A?"":'<div class="ctc-swatch ctc-specific" id="ctc_child_'+x+"_"+v+'_swatch">'+ctcAjax.swatch_txt+"</div>"+p+'<div class="ctc-child-input-cell ctc-button-cell" id="ctc_save_'+x+"_"+v+'_cell">'+p+'<input type="button" class="button ctc-save-input" id="ctc_save_'+x+"_"+v+'" name="ctc_save_'+x+"_"+v+'" value="Save" /></div>'+p);t+="</div><!-- end input row -->"+p}return t},e=function(r){if(1===loading.sel_val){return false}if(0==loading.sel_val){loading.sel_val=1;ctc_query_css("sel_val",r,e);return false}var u,s,t;if(b(ctcAjax.sel_val[r])){g("#ctc_sel_ovrd_rule_inputs").html("")}else{if(b(ctcAjax.sel_val[r].seq)){g("#ctc_child_load_order_container").html("")}else{u="ctc_ovrd_child_seq_"+r;t=parseInt(ctcAjax.sel_val[r].seq);s='<input type="text" id="'+u+'" name="'+u+'" class="ctc-child-value" value="'+t+'" />';g("#ctc_child_load_order_container").html(s)}if(b(ctcAjax.sel_val[r].value)){g("#ctc_sel_ovrd_rule_inputs").html("")}else{s="";g.each(ctcAjax.sel_val[r].value,function(w,v){s+=h(r,w,"ovrd")});g("#ctc_sel_ovrd_rule_inputs").html(s).find(".color-picker").each(function(){q(this)});k("#ctc_child_all_0_swatch")}}};ctc_render_rule_value_inputs=function(s){if(1===loading.rule_val){return false}if(0==loading.rule_val){loading.rule_val=1;ctc_query_css("rule_val",s,ctc_render_rule_value_inputs);return false}var t=ctcAjax.rule[s],r='<div class="ctc-input-row clearfix" id="ctc_rule_row_'+t+'">'+p;if(false===b(ctcAjax.rule_val[s])){g.each(ctcAjax.rule_val[s],function(v,w){var u=ctc_decode_value(t,w);r+='<div class="ctc-parent-row clearfix" id="ctc_rule_row_'+t+"_"+v+'">'+p;r+='<div class="ctc-input-cell ctc-parent-value" id="ctc_'+v+"_parent_"+t+"_"+v+'">'+u.orig+"</div>"+p;r+='<div class="ctc-input-cell">'+p;r+='<div class="ctc-swatch ctc-specific" id="ctc_'+v+"_parent_"+t+"_"+v+'_swatch">'+ctcAjax.swatch_txt+"</div></div>"+p;r+='<div class="ctc-input-cell"><a href="#" class="ctc-selector-handle" id="ctc_selector_'+t+"_"+v+'">'+ctcAjax.selector_txt+"</a></div>"+p;r+='<div id="ctc_selector_'+t+"_"+v+'_container" class="ctc-selector-container clearfix">'+p;r+='<a href="#" id="ctc_selector_'+t+"_"+v+'_close" class="ctc-selector-handle" style="float:right">'+ctcAjax.close_txt+'</a><div id="ctc_status_val_qry_'+v+'"></div>'+p;r+='<div id="ctc_selector_'+t+"_"+v+'_rows"></div>'+p;r+="</div></div>"+p});r+="</div>"+p}g("#ctc_rule_value_inputs").html(r).find(".ctc-swatch").each(function(){k(this)})},ctc_render_selector_value_inputs=function(u){if(1==loading.val_qry){return false}var w,s,v=g("#ctc_rule_menu_selected").text().replace(/[^\w\-]/g,i),r,t="";if(0===loading.val_qry){loading.val_qry=1;w={rule:v};ctc_query_css("val_qry",u,ctc_render_selector_value_inputs,w);return false}if(false===b(ctcAjax.val_qry[u])){g.each(ctcAjax.val_qry[u],function(y,x){page_rule=y;g.each(x,function(A,z){t+='<h4 class="ctc-query-heading">'+A+"</h4>"+p;if(false===b(z)){g.each(z,function(B,C){ctcAjax.sel_val[B]=C;t+=h(B,y,u)})}})})}r="#ctc_selector_"+v+"_"+u+"_rows";g(r).html(t).find(".color-picker").each(function(){q(this)});g(r).find(".ctc-swatch").each(function(){k(this)})},ctc_query_css=function(t,s,w,u){var r={ctc_query_obj:t,ctc_query_key:s},v="#ctc_status_"+t+("val_qry"==t?"_"+s:"");if("object"===typeof u){g.each(u,function(x,y){r["ctc_query_"+x]=y})}g(".ctc-status-icon").remove();g(v).append('<span class="ctc-status-icon spinner"></span>');g(".spinner").show();r.action="ctc_query";r._wpnonce=g("#_wpnonce").val();g.post(ctcAjax.ajaxurl,r,function(x){loading[t]=2;g(".ctc-status-icon").removeClass("spinner");if(b(x)){g(".ctc-status-icon").addClass("failure")}else{g(".ctc-status-icon").addClass("success");c(x);if("function"===typeof w){w(s)}return false}},"json").fail(function(){loading[t]=0;g(".ctc-status-icon").removeClass("spinner");g(".ctc-status-icon").addClass("failure")});return false},ctc_save=function(v){var u={},w,t,r,s,x=g(v).attr("id");if(b(o[x])){o[x]=0}o[x]++;g(v).prop("disabled",true);g(".ctc-status-icon").remove();g(v).parent(".ctc-textarea-button-cell, .ctc-button-cell").append('<span class="ctc-status-icon spinner"></span>');g(".spinner").show();if((w=g("#ctc_new_selectors"))&&"ctc_save_new_selectors"==g(v).attr("id")){u.ctc_new_selectors=w.val();if(t=g("#ctc_sel_ovrd_query_selected")){u.ctc_sel_ovrd_query=t.text()}}else{if((r=g("#ctc_child_imports"))&&"ctc_save_imports"==g(v).attr("id")){u.ctc_child_imports=r.val()}else{u=k(v)}}u.action="ctc_update";u._wpnonce=g("#_wpnonce").val();g.post(ctcAjax.ajaxurl,u,function(y){g(v).prop("disabled",false);g(".ctc-status-icon").removeClass("spinner");if(b(y)){g(".ctc-status-icon").addClass("failure")}else{g(".ctc-status-icon").addClass("success");g("#ctc_new_selectors").val("");c(y);ctc_setup_menus()}return false},"json").fail(function(){g(v).prop("disabled",false);g(".ctc-status-icon").removeClass("spinner");g(".ctc-status-icon").addClass("failure")});return false},ctc_decode_value=function(t,r){r=("undefined"==typeof r?"":r);var s={orig:r};if(t.toString().match(/^border(\-(top|right|bottom|left))?$/)){var u=r.toString().split(/ +/);s.names=["_border_width","_border_style","_border_color"];s.values=[("undefined"==typeof u[0]?"":u[0]),("undefined"==typeof u[1]?"":u[1]),("undefined"==typeof u[2]?"":u[2])]}else{if(t.toString().match(/^background\-image/)){s.names=["_background_url","_background_origin","_background_color1","_background_color2"];s.values=["","","",""];if(false===(b(r))&&!(r.toString().match(/url/))){var u=r.toString().split(/:/);s.values[1]=("undefined"==typeof u[0]?"":u[0]);s.values[2]=("undefined"==typeof u[1]?"":u[1]);s.values[3]=("undefined"==typeof u[3]?"":u[3]);s.orig=[s.values[1],s.values[2],s.values[3]].join(" ")}else{s.values[0]=r}}else{s.names=[""];s.values=[r]}}return s},ctc_set_query=function(r){m=r;g("#ctc_sel_ovrd_query").val("");g("#ctc_sel_ovrd_query_selected").text(r);g("#ctc_sel_ovrd_selector").val("");g("#ctc_sel_ovrd_selector_selected").html("&nbsp;");g("#ctc_sel_ovrd_rule_inputs").html("");ctc_setup_selector_menu(r);k("#ctc_child_all_0_swatch");g("#ctc_new_selector_row").show()},ctc_set_selector=function(s,r){g("#ctc_sel_ovrd_selector").val("");g("#ctc_sel_ovrd_selector_selected").text(r);g("#ctc_sel_ovrd_qsid").val(s);a=s;if(1!=loading.sel_val){loading.sel_val=0}e(s);g("#ctc_sel_ovrd_new_rule, #ctc_sel_ovrd_rule_header,#ctc_sel_ovrd_rule_inputs_container,#ctc_sel_ovrd_rule_inputs").show()},ctc_set_rule=function(s,r){g("#ctc_rule_menu").val("");g("#ctc_rule_menu_selected").text(r);if(1!=loading.rule_val){loading.rule_val=0}ctc_render_rule_value_inputs(s);g("#ctc_rule_value_inputs,#ctc_input_row_rule_header").show()},ctc_setup_query_menu=function(){ctc_queries=j();g("#ctc_sel_ovrd_query").autocomplete({source:ctc_queries,minLength:0,selectFirst:true,autoFocus:true,select:function(s,r){ctc_set_query(r.item.value);return false},focus:function(r){r.preventDefault()}})},ctc_setup_selector_menu=function(r){ctc_selectors=f(r);g("#ctc_sel_ovrd_selector").autocomplete({source:ctc_selectors,selectFirst:true,autoFocus:true,select:function(t,s){ctc_set_selector(s.item.value,s.item.label);return false},focus:function(s){s.preventDefault()}})},ctc_setup_rule_menu=function(){ctc_rules=n();g("#ctc_rule_menu").autocomplete({source:ctc_rules,selectFirst:true,autoFocus:true,select:function(s,r){ctc_set_rule(r.item.value,r.item.label);return false},focus:function(r){r.preventDefault()}})},ctc_filtered_rules=function(u,s){var r=[],t=(b(ctcAjax.sel_val[a]))||(b(ctcAjax.sel_val[a].value));if(b(ctc_rules)){ctc_rules=n()}g.each(ctc_rules,function(v,y){var w=false,x=new RegExp(g.ui.autocomplete.escapeRegex(u.term),"i");if(x.test(y.label)){if(false===t){g.each(ctcAjax.sel_val[a].value,function(A,z){if(y.label==A.replace(/\d+/g,l)){w=true;return false}});if(w){return}}r.push(y)}});s(r)},ctc_setup_new_rule_menu=function(){g("#ctc_new_rule_menu").autocomplete({source:ctc_filtered_rules,selectFirst:true,autoFocus:true,select:function(s,r){s.preventDefault();var t=g(h(a,r.item.label,"ovrd"));g("#ctc_sel_ovrd_rule_inputs").append(t);g("#ctc_new_rule_menu").val("");if(b(ctcAjax.sel_val[a].value)){ctcAjax.sel_val[a]["value"]={}}ctcAjax.sel_val[a].value[r.item.label]={child:""};t.find('input[type="text"]').each(function(u,v){if(g(v).hasClass("color-picker")){q(v)}g(v).focus()});return false},focus:function(r){r.preventDefault()}})},ctc_setup_menus=function(){ctc_setup_query_menu();ctc_setup_selector_menu(m);ctc_setup_rule_menu();ctc_setup_new_rule_menu()},ctc_theme_exists=function(r,s){var t=false;g.each(ctcAjax.themes,function(u,v){g.each(v,function(w,x){if(w==r&&("parnt"==u||"new"==s)){t=true;return false}});if(t){return false}});return t},ctc_set_notice=function(r){var s="";if(false===b(r)){g.each(r,function(t,u){s+='<div class="'+t+'"><ul>'+p;g(u).each(function(v,w){s+="<li>"+w.toString()+"</li>"+p});s+="</ul></div>"})}g("#ctc_error_notice").html(s)},ctc_validate=function(){var u=/[^\w\-]/,s=g("#ctc_child_template").val().toString().replace(u).toLowerCase(),r=g("#ctc_theme_child").val().toString().replace(u).toLowerCase(),t=g("input[name=ctc_child_type]:checked").val(),v=[];if("new"==t){r=s}if(ctc_theme_exists(r,t)){v.push(ctcAjax.theme_exists_txt.toString().replace(/%s/,r))}if(""===r){v.push(ctcAjax.inval_theme_txt)}if(""===g("#ctc_child_name").val()){v.push(ctcAjax.inval_name_txt)}if(v.length){ctc_set_notice({error:v});return false}return true},ctc_set_theme_menu=function(s){var r=g("#ctc_theme_child").val();if(false===b(ctcAjax.themes.child[r])){g("#ctc_child_name").val(ctcAjax.themes.child[r].Name);g("#ctc_child_author").val(ctcAjax.themes.child[r].Author);g("#ctc_child_version").val(ctcAjax.themes.child[r].Version)}},fade_update_notice=function(){g(".updated, .error").slideUp("slow",function(){g(".updated").remove()})},ctc_focus_panel=function(s){var r=s+"_panel";g(".nav-tab").removeClass("nav-tab-active");g(".ctc-option-panel").removeClass("ctc-option-panel-active");g(".ctc-selector-container").hide();g(s).addClass("nav-tab-active");g(".ctc-option-panel-container").scrollTop(0);g(r).addClass("ctc-option-panel-active")},ctc_selector_edit=function(v){var r=g(v).attr("id").match(/_(\d+)$/)[1],u=ctcAjax.sel_val[r].query,t=ctcAjax.sel_val[r].selector,w="#query_selector_options";ctc_set_query(u);ctc_set_selector(r,t);ctc_focus_panel(w)},loading={rule:2,sel_ndx:2,val_qry:0,rule_val:0,sel_val:0},ctc_selectors=[],ctc_queries=[],ctc_rules=[];g(".color-picker").each(function(){q(this)});g(".ctc-option-panel-container").on("focus",".color-picker",function(){ctc_set_notice("");g(this).iris("toggle");g(".iris-picker").css({position:"absolute","z-index":10})});g(".ctc-option-panel-container").on("focus","input",function(){ctc_set_notice("");g(".color-picker").not(this).iris("hide")});g(".ctc-option-panel-container").on("change",".ctc-child-value, input[type=checkbox]",function(){k(this)});g(".ctc-option-panel-container").on("click",".ctc-selector-handle",function(s){s.preventDefault();ctc_set_notice("");var t=g(this).attr("id").toString().replace("_close",""),r=t.toString().match(/_(\d+)$/)[1];if(g("#"+t+"_container").is(":hidden")){if(1!=loading.val_qry){loading.val_qry=0}ctc_render_selector_value_inputs(r)}g("#"+t+"_container").fadeToggle("fast");g(".ctc-selector-container").not("#"+t+"_container").fadeOut("fast")});g(".nav-tab").on("click",function(r){r.preventDefault();ctc_set_notice("");var s="#"+g(this).attr("id");ctc_focus_panel(s)});g("#view_child_options,#view_parnt_options").on("click",function(u){ctc_set_notice("");var r=new Date().getTime(),t=g(this).attr("id").toString().match(/(child|parnt)/)[1],s=ctcAjax.theme_uri+"/"+ctcAjax[t]+"/style.css?"+r;g.get(s,function(v){g("#view_"+t+"_options_panel").text(v)}).fail(function(){g("#view_"+t+"_options_panel").text(ctcAjax.css_fail_txt)})});g("#ctc_load_form").on("submit",function(){return(ctc_validate()&&confirm(ctcAjax.load_txt))});g("#parent_child_options_panel").on("change","#ctc_theme_child",ctc_set_theme_menu);g(document).on("click",".ctc-save-input",function(r){ctc_save(this)});g(document).on("click",".ctc-selector-edit",function(r){ctc_selector_edit(this)});ctc_setup_menus();ctc_set_query(m);g("input[type=submit],input[type=button]").prop("disabled",false);setTimeout(fade_update_notice,6000)});